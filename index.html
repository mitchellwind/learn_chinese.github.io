<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Daily Characters</title>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            font-size: 2em;
            margin: 10px 0;
        }

        button {
            margin: 5px;
            padding: 8px 12px;
            font-size: 14px;
        }

        .controls {
            margin: 15px 0;
        }

        .tabs {
            margin: 20px 0;
        }

        .tab-button {
            padding: 8px 12px;
            margin-right: 5px;
            cursor: pointer;
            border: 1px solid #ccc;
            background: #eee;
        }

        .tab-button.active {
            background: #ddd;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .week-cols {
            display: flex;
            gap: 20px;
        }

        .week-col {
            flex: 1;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 15px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: center;
        }
    </style>
</head>

<body>
    <h2>Chinese Learning</h2>

    <!-- Tabs -->
    <div class="tabs">
        <button class="tab-button active" data-tab="daily">Daily</button>
        <button class="tab-button" data-tab="weekly">Weekly</button>
        <button class="tab-button" data-tab="all">All</button>
    </div>

    <!-- Toggle -->
    <label>
        <input type="checkbox" id="togglePinyin" checked>
        Show Pinyin
    </label>

    <!-- Daily tab -->
    <div id="daily" class="tab-content active">
        <div class="controls">
            <button id="prevBtn">← Previous</button>
            <input type="range" id="daySlider" min="1" max="10" value="1">
            <button id="nextBtn">Next →</button>
            <span id="dayLabel">Week 1, Day 1</span>
        </div>
        <div id="dailyOutput"></div>
    </div>


    <!-- Weekly tab -->
    <div id="weekly" class="tab-content">
        <label>Select week: <select id="weekSelect"></select></label>
        <div id="weeklyOutput" class="week-cols"></div>
    </div>

    <!-- All tab -->
    <div id="all" class="tab-content">
        <h3>Full Dataset</h3>
        <div id="allOutput"></div>
    </div>

    <script>
        let data = [];
        let currentDay = 1;
        let weeks = [];

        Papa.parse("daily_with_pinyin.csv", {
            download: true,
            header: true,
            complete: function (results) {
                data = results.data.filter(d => d.day); // drop empty
                // Get days and weeks
                const days = [...new Set(data.map(d => d.day))].map(Number).sort((a, b) => a - b);
                weeks = [...new Set(data.map(d => d.week))].map(Number).sort((a, b) => a - b);

                // init slider
                document.getElementById("daySlider").max = Math.max(...days);

                // init week dropdown
                const weekSelect = document.getElementById("weekSelect");
                weeks.forEach(w => {
                    const opt = document.createElement("option");
                    opt.value = w;
                    opt.textContent = "Week " + w;
                    weekSelect.appendChild(opt);
                });

                renderDay(currentDay);
                renderWeek(weeks[0]);
                renderAll();
            }
        });

        function renderDay(dayIdx) {
            currentDay = dayIdx;
            const showPinyin = document.getElementById("togglePinyin").checked;
            const output = document.getElementById("dailyOutput");
            output.innerHTML = "";

            const rows = data.filter(d => Number(d.day) === dayIdx);
            if (rows.length > 0) {
                const row = rows[0];
                const weekIdx = row.week;   // ✅ get week index
                Object.keys(row).forEach(col => {
                    if (col !== "week" && col !== "day" && row[col]) {
                        const val = row[col].trim();
                        const text = showPinyin ? val : val.split(/\s+/)[0];
                        const h = document.createElement("h1");
                        h.textContent = text;
                        output.appendChild(h);
                    }
                });
                document.getElementById("dayLabel").textContent = `Week ${weekIdx}, Day ${dayIdx}`;
            } else {
                document.getElementById("dayLabel").textContent = `Day ${dayIdx} (no data)`;
            }

            document.getElementById("daySlider").value = dayIdx;
        }


        function renderWeek(weekIdx) {
            const showPinyin = document.getElementById("togglePinyin").checked;
            const rows = data.filter(d => Number(d.week) === weekIdx);
            const output = document.getElementById("weeklyOutput");
            output.innerHTML = "";

            // Create 3 columns
            const cols = [document.createElement("div"), document.createElement("div"), document.createElement("div")];
            cols.forEach(c => c.className = "week-col");

            rows.forEach(row => {
                Object.keys(row).forEach((col, n) => {
                    if (col !== "week" && col !== "day" && row[col]) {
                        const val = row[col].trim();
                        const text = showPinyin ? val : val.split(/\s+/)[0];
                        const h = document.createElement("h1");
                        h.textContent = text;
                        if (cols[n]) cols[n].appendChild(h);
                    }
                });
            });
            cols.forEach(c => output.appendChild(c));
        }

        function renderAll() {
            const showPinyin = document.getElementById("togglePinyin").checked;
            const output = document.getElementById("allOutput");
            output.innerHTML = "";

            const table = document.createElement("table");
            const headerRow = document.createElement("tr");
            Object.keys(data[0]).forEach(k => {
                const th = document.createElement("th");
                th.textContent = k;
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);

            data.forEach(row => {
                const tr = document.createElement("tr");
                Object.keys(row).forEach(col => {
                    let val = row[col];
                    if (col !== "week" && col !== "day" && val) {
                        val = showPinyin ? val : val.split(/\s+/)[0];
                    }
                    const td = document.createElement("td");
                    td.textContent = val;
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });

            output.appendChild(table);
        }

        // Event bindings
        document.getElementById("prevBtn").addEventListener("click", () => {
            if (currentDay > 1) renderDay(currentDay - 1);
        });
        document.getElementById("nextBtn").addEventListener("click", () => {
            renderDay(currentDay + 1);
        });
        document.getElementById("daySlider").addEventListener("input", e => {
            renderDay(Number(e.target.value));
        });
        document.getElementById("weekSelect").addEventListener("change", e => {
            renderWeek(Number(e.target.value));
        });
        document.getElementById("togglePinyin").addEventListener("change", () => {
            renderDay(currentDay);
            renderWeek(Number(document.getElementById("weekSelect").value));
            renderAll();
        });

        // Tabs switching
        document.querySelectorAll(".tab-button").forEach(btn => {
            btn.addEventListener("click", () => {
                document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
                document.getElementById(btn.dataset.tab).classList.add("active");
            });
        });
    </script>
</body>

</html>